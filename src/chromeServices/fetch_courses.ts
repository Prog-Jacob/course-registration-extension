import { Course } from '../types/course';
import { defaultData } from '../components/courses/data';

export default async function fetchCourses(viewState: string, eventValidation: string, studentId: string): Promise<Course[]> {
  const parser = new DOMParser();
  const body = await fetchCoursesBody(viewState, eventValidation, studentId);
  const doc = parser.parseFromString(body, 'text/html');
  // Parse courses from the document.
  // const courses: Course[] = [];
  return defaultData.map((course, index) => ({ ...course, priority: index + 1 }));
}

export async function fetchCoursesBody(viewState: string, eventValidation: string, studentId: string): Promise<string> {
  viewState = encodeURIComponent(viewState);
  studentId = encodeURIComponent(studentId);
  eventValidation = encodeURIComponent(eventValidation);
  const response = await fetch('https://sis.ejust.edu.eg/UI/StudentViewAdmin/STD_CRS_REG_PLN_Grouping.aspx', {
    headers: {
      accept: '*/*',
      'accept-language': 'en-US,en;q=0.9,ar;q=0.8',
      'cache-control': 'no-cache',
      'content-type': 'application/x-www-form-urlencoded; charset=UTF-8',
      'sec-ch-ua': '"Microsoft Edge";v="117", "Not;A=Brand";v="8", "Chromium";v="117"',
      'sec-ch-ua-mobile': '?0',
      'sec-ch-ua-platform': '"Windows"',
      'sec-fetch-dest': 'empty',
      'sec-fetch-mode': 'cors',
      'sec-fetch-site': 'same-origin',
      'x-microsoftajax': 'Delta=true',
      'x-requested-with': 'XMLHttpRequest',
    },
    referrer: 'https://sis.ejust.edu.eg/UI/StudentViewAdmin/STD_CRS_REG_PLN_Grouping.aspx',
    referrerPolicy: 'strict-origin-when-cross-origin',
    body: `ctl00%24ScriptManager1=ctl00%24cntphmaster%24updPnlStudCourseReg%7Cctl00%24cntphmaster%24lnkAddNewReg&__EVENTTARGET=ctl00%24cntphmaster%24lnkAddNewReg&__EVENTARGUMENT=&__LASTFOCUS=&__VIEWSTATE=${viewState}&__VIEWSTATEGENERATOR=8143B670&__VIEWSTATEENCRYPTED=&__EVENTVALIDATION=${eventValidation}&ctl00_ASPxPopupControl1WS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A-10000%3A-10000%3A1&ctl00%24FixNumericBoxProblem=&ctl00%24txtFixCalendarProblem=&ctl00%24MaskedBirthDate_ClientState=&ctl00%24txtSearch=&ctl00%24cntphmaster%24hdnchkconfirm=&ctl00%24cntphmaster%24hdnRegMthdFlg=1&ctl00%24cntphmaster%24ucStudDataGeneralControl%24txtInsertMode=false&ctl00_cntphmaster_ucStudDataGeneralControl_StudentDtlPopupWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A-10000%3A-10000%3A1&ctl00%24cntphmaster%24ucStudDataGeneralControl%24StudentDtlPopup%24ucStudDtlsTabsGnrlCtrl%24TabHeader1%24txtTabLvl=1&ctl00%24cntphmaster%24ucStudDataGeneralControl%24StudentDtlPopup%24ucStudDtlsTabsGnrlCtrl%24TabHeader1%24Tab_UcStudentBasicDataTabs_0%24ucTabHeader%24txtTabLvl=2&ctl00%24cntphmaster%24ucStudDataGeneralControl%24StudentDtlPopup%24ucStudDtlsTabsGnrlCtrl%24TabHeader1%24Tab_UcStudentBasicDataTabs_0%24ucTabHeader%24Tab_StudBasicData_View_0%24txtStudId=${studentId}&ctl00%24cntphmaster%24ucStudDataGeneralControl%24StudentDtlPopup%24ucStudDtlsTabsGnrlCtrl%24TabHeader1%24Tab_UcStudentBasicDataTabs_0%24ucTabHeader%24Tab_StudBasicData_View_0%24txthiddenStudID=ED_STUD_ID%3D${studentId}&ctl00%24cntphmaster%24ucStudDataGeneralControl%24StudentDtlPopup%24ucStudDtlsTabsGnrlCtrl%24TabHeader1%24Tab_UcStudentBasicDataTabs_0%24ucTabHeader%24Tab_StudBasicData_View_0%24UpdatedStudID=${studentId}&ctl00_cntphmaster_ucStudDataGeneralControl_StudentDtlPopup_ucStudDtlsTabsGnrlCtrl_StudentDtlPopupWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A999px%3A-10000%3A1&ctl00_cntphmaster_ucStudDataGeneralControl_StudentDtlAfcmPopupWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A-10000%3A-10000%3A1&ctl00%24cntphmaster%24ucStudDataGeneralControl%24StudentDtlAfcmPopup%24StudDtlsTabsGnrlCtrlAfcm%24TabHeader1%24txtTabLvl=1&ctl00%24cntphmaster%24ucStudDataGeneralControl%24StudentDtlAfcmPopup%24StudDtlsTabsGnrlCtrlAfcm%24TabHeader1%24Tab_UcStudentBasicDataTabs_0%24ucTabHeader%24txtTabLvl=2&ctl00%24cntphmaster%24ucStudDataGeneralControl%24StudentDtlAfcmPopup%24StudDtlsTabsGnrlCtrlAfcm%24TabHeader1%24Tab_UcStudentBasicDataTabs_0%24ucTabHeader%24Tab_StudBasicData_View_0%24txtStudId=${studentId}&ctl00%24cntphmaster%24ucStudDataGeneralControl%24StudentDtlAfcmPopup%24StudDtlsTabsGnrlCtrlAfcm%24TabHeader1%24Tab_UcStudentBasicDataTabs_0%24ucTabHeader%24Tab_StudBasicData_View_0%24txthiddenStudID=ED_STUD_ID%3D${studentId}&ctl00%24cntphmaster%24ucStudDataGeneralControl%24StudentDtlAfcmPopup%24StudDtlsTabsGnrlCtrlAfcm%24TabHeader1%24Tab_UcStudentBasicDataTabs_0%24ucTabHeader%24Tab_StudBasicData_View_0%24UpdatedStudID=${studentId}&ctl00_cntphmaster_ucStudDataGeneralControl_StudentDtlAfcmPopup_StudDtlsTabsGnrlCtrlAfcm_StudentDtlPopupWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A999px%3A-10000%3A1&ctl00%24cntphmaster%24hdnRegNewCourse=&ctl00_cntphmaster_AspPopubReptdCrsWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A850px%3A-10000%3A1&ctl00%24cntphmaster%24AspPopubReptdCrs%24txtRepeatedCrs=&ctl00%24cntphmaster%24hdnExceptional=&ctl00_cntphmaster_OtherCoursePopUpWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A850px%3A-10000%3A1&ctl00%24cntphmaster%24OtherCoursePopUp%24txtCourseCode=&ctl00%24cntphmaster%24ucRegisteredCourses%24hidIndex=&ctl00%24cntphmaster%24ucRegisteredCourses%24hdnOldCourse=&ctl00%24cntphmaster%24ucRegisteredCourses%24hdnCourseRegId=&ctl00%24cntphmaster%24ucRegisteredCourses%24hdnGroupFlg=0&ctl00_cntphmaster_ucRegisteredCourses_ReplaceCoursePopUpWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A850px%3A-10000%3A1&ctl00%24cntphmaster%24ucRegisteredCourses%24ReplaceCoursePopUp%24txtcrscode=&ctl00%24cntphmaster%24ucRegisteredCourses%24ReplaceCoursePopUp%24HdnNewcrsid=&ctl00_cntphmaster_ucRegisteredCourses_PopupCommentWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A850px%3A-10000%3A1&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupComment%24txtComment=&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupComment%24hdnEdStudCourseRegId=&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupComment%24hdnCommentRowIndex=&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupComment%24hdnActionType=&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupComment%24hdnChngResnId=&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupComment%24hdnCommentSavedSuccess=&ctl00_cntphmaster_ucRegisteredCourses_NotePopupWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A950px%3A-10000%3A1&ctl00%24cntphmaster%24ucRegisteredCourses%24NotePopup%24txtNotes=&ctl00_cntphmaster_ucRegisteredCourses_PopupCourseReplaceWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A800px%3A-10000%3A1&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupCourseReplace%24txtCourseCode=&ctl00_cntphmaster_ucRegisteredCourses_PopupCourseChangeReasonWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A500px%3A-10000%3A1&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupCourseChangeReason%24drpChangeReason=0&ctl00_cntphmaster_ucRegisteredCourses_PopupCourseUnDropWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A500px%3A-10000%3A1&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupCourseUnDrop%24UCRegisterAddReplaceCourseDirect_Grouping1%24Select=rdbAcadPlan&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupCourseUnDrop%24UCRegisterAddReplaceCourseDirect_Grouping1%24txtCourseCode=&ctl00_cntphmaster_ucRegisteredCourses_PopupCourseUnDrop_UCRegisterAddReplaceCourseDirect_Grouping1_PopupCourseChangeReasonWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A500px%3A-10000%3A1&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupCourseUnDrop%24UCRegisterAddReplaceCourseDirect_Grouping1%24PopupCourseChangeReason%24drpChangeReason=0&ctl00_cntphmaster_ucRegisteredCourses_PopupCourseUnDrop_UCRegisterAddReplaceCourseDirect_Grouping1_NotePopupWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A500px%3A-10000%3A1&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupCourseUnDrop%24UCRegisterAddReplaceCourseDirect_Grouping1%24NotePopup%24txtNotes=&ctl00_cntphmaster_ucRegisteredCourses_PopupCourseUnDrop_UCRegisterAddReplaceCourseDirect_Grouping1_PopupAddCourseWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A600px%3A-10000%3A1&ctl00_cntphmaster_ucRegisteredCourses_PopupCourseUnDrop_UCRegisterAddReplaceCourseDirect_Grouping1_PopupTimeTableWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A600px%3A-10000%3A1&ctl00_cntphmaster_ucRegisteredCourses_PopupCourseUnDrop_UCRegisterAddReplaceCourseDirect_Grouping1_PopupCourseSectionConWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A500px%3A-10000%3A1&ctl00_cntphmaster_ucRegisteredCourses_PopupSrchCourseSectionWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A999px%3A-10000%3A1&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupSrchCourseSection%24ucRegisterAddReplaceCourse%24Select=rdbAcadPlan&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupSrchCourseSection%24ucRegisterAddReplaceCourse%24txtCourseCode=&ctl00_cntphmaster_ucRegisteredCourses_PopupSrchCourseSection_ucRegisterAddReplaceCourse_PopupCourseChangeReasonWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A500px%3A-10000%3A1&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupSrchCourseSection%24ucRegisterAddReplaceCourse%24PopupCourseChangeReason%24drpChangeReason=0&ctl00_cntphmaster_ucRegisteredCourses_PopupSrchCourseSection_ucRegisterAddReplaceCourse_NotePopupWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A500px%3A-10000%3A1&ctl00%24cntphmaster%24ucRegisteredCourses%24PopupSrchCourseSection%24ucRegisterAddReplaceCourse%24NotePopup%24txtNotes=&ctl00_cntphmaster_ucRegisteredCourses_PopupSrchCourseSection_ucRegisterAddReplaceCourse_PopupAddCourseWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A600px%3A-10000%3A1&ctl00_cntphmaster_ucRegisteredCourses_PopupSrchCourseSection_ucRegisterAddReplaceCourse_PopupTimeTableWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A600px%3A-10000%3A1&ctl00_cntphmaster_ucRegisteredCourses_PopupSrchCourseSection_ucRegisterAddReplaceCourse_PopupCourseSectionConWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A500px%3A-10000%3A1&ctl00_cntphmaster_ucRegisteredCourses_popupDirectCoursesWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A999px%3A-10000%3A1&ctl00%24cntphmaster%24ucRegisteredCourses%24popupDirectCourses%24ucDirectRegisterAddReplaceCourse%24Select=rdbAcadPlan&ctl00%24cntphmaster%24ucRegisteredCourses%24popupDirectCourses%24ucDirectRegisterAddReplaceCourse%24txtCourseCode=&ctl00_cntphmaster_ucRegisteredCourses_popupDirectCourses_ucDirectRegisterAddReplaceCourse_PopupCourseChangeReasonWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A500px%3A-10000%3A1&ctl00%24cntphmaster%24ucRegisteredCourses%24popupDirectCourses%24ucDirectRegisterAddReplaceCourse%24PopupCourseChangeReason%24drpChangeReason=0&ctl00_cntphmaster_ucRegisteredCourses_popupDirectCourses_ucDirectRegisterAddReplaceCourse_NotePopupWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A500px%3A-10000%3A1&ctl00%24cntphmaster%24ucRegisteredCourses%24popupDirectCourses%24ucDirectRegisterAddReplaceCourse%24NotePopup%24txtNotes=&ctl00_cntphmaster_ucRegisteredCourses_popupDirectCourses_ucDirectRegisterAddReplaceCourse_PopupAddCourseWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A600px%3A-10000%3A1&ctl00_cntphmaster_ucRegisteredCourses_popupDirectCourses_ucDirectRegisterAddReplaceCourse_PopupTimeTableWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A600px%3A-10000%3A1&ctl00_cntphmaster_ucRegisteredCourses_popupDirectCourses_ucDirectRegisterAddReplaceCourse_PopupCourseSectionConWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A500px%3A-10000%3A1&ctl00_cntphmaster_ucRegisteredCourses_PopupTimeTableWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A600px%3A-10000%3A1&ctl00_cntphmaster_ucRegisteredCourses_PopupCourseSectionConWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A500px%3A-10000%3A1&ctl00_cntphmaster_ucRegisteredCourses_PopupFindCoursesWS=0%3A0%3A-1%3A-10000%3A-10000%3A0%3A500px%3A-10000%3A1&ctl00%24txthdndegreeclassctrl_Ids=0&DXScript=1_42%2C1_74%2C1_67%2C1_64&__ASYNCPOST=true&`,
    method: 'POST',
    mode: 'cors',
    credentials: 'include',
  });

  return response.text();
}
